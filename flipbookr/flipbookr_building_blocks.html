<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>flipbookr building blocks</title>
    <meta charset="utf-8" />
    <meta name="author" content="Gina Reynolds, December 2019" />
    <link href="libs/remark-css-0.0.1/ninjutsu.css" rel="stylesheet" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# flipbookr building blocks
## what lies beneath
### Gina Reynolds, December 2019

---



```r
library(flipbookr)
library(tidyverse)
```

```
## ── Attaching packages ────────────────────── tidyverse 1.2.1 ──
```

```
## ✓ ggplot2 3.3.0.9000     ✓ purrr   0.3.3     
## ✓ tibble  2.1.3          ✓ dplyr   0.8.4     
## ✓ tidyr   1.0.2          ✓ stringr 1.4.0     
## ✓ readr   1.3.1          ✓ forcats 0.4.0
```

```
## ── Conflicts ───────────────────────── tidyverse_conflicts() ──
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()
```

```r
knitr::opts_chunk$set(fig.width = 6, message = F, warning = F, comment = "", cache = F)
```


```r
xaringanthemer::mono_accent(
  code_highlight_color = "rgba(255, 211, 0, .35)",
  base_color = "#03418A")
```

```
[1] "xaringan-themer.css"
```

---


We'll use the tidyverse packages to create a pipeline, and flipbookr to walk through the steps in this pipeline.


```r
library(tidyverse)
library(flipbookr)
```

The input code to be "flipbookified" is below:


```r
cars %&gt;%  #BREAK          
  ggplot() +  
  aes(x = speed) + 
  aes(color = speed) + #BREAK2
  geom_rug() #BREAK
```


---

Let's first look at the result of using flipbookr to bring this code.

---

class: split-40
count: false
.column[.content[

```r
*cars
```
]]
.column[.content[

```
   speed dist
1      4    2
2      4   10
3      7    4
4      7   22
5      8   16
6      9   10
7     10   18
8     10   26
9     10   34
10    11   17
11    11   28
12    12   14
13    12   20
14    12   24
15    12   28
16    13   26
17    13   34
18    13   34
19    13   46
20    14   26
21    14   36
22    14   60
23    14   80
24    15   20
25    15   26
26    15   54
27    16   32
28    16   40
29    17   32
30    17   40
31    17   50
32    18   42
33    18   56
34    18   76
35    18   84
36    19   36
37    19   46
38    19   68
39    20   32
40    20   48
41    20   52
42    20   56
43    20   64
44    22   66
45    23   54
46    24   70
47    24   92
48    24   93
49    24  120
50    25   85
```
]]
---
class: split-40
count: false
.column[.content[

```r
cars %&gt;%  
* ggplot()
```
]]
.column[.content[
![](flipbookr_building_blocks_files/figure-html/cars_plot_auto_2_output-1.png)&lt;!-- --&gt;
]]
---
class: split-40
count: false
.column[.content[

```r
cars %&gt;%  
  ggplot() +  
* aes(x = speed)
```
]]
.column[.content[
![](flipbookr_building_blocks_files/figure-html/cars_plot_auto_3_output-1.png)&lt;!-- --&gt;
]]
---
class: split-40
count: false
.column[.content[

```r
cars %&gt;%  
  ggplot() +  
  aes(x = speed) +  
* aes(color = speed)
```
]]
.column[.content[
![](flipbookr_building_blocks_files/figure-html/cars_plot_auto_4_output-1.png)&lt;!-- --&gt;
]]
---
class: split-40
count: false
.column[.content[

```r
cars %&gt;%  
  ggplot() +  
  aes(x = speed) +  
  aes(color = speed) +  
* geom_rug()
```
]]
.column[.content[
![](flipbookr_building_blocks_files/figure-html/cars_plot_auto_5_output-1.png)&lt;!-- --&gt;
]]

---


# Move to automate


## 1. *Automatically* parsing a block of input code 

--

## 2. *Automatically* reconstructing code into partial builds

--

## 3. *Automatically* delivered on a presentation platform (here Xaringan)



---

Now, lets look at some of the functions working in the background.


---
class: middle center inverse

# Step 1
## Parse block of input code


---

class: split-40
count: false
.column[.content[

```r
*flipbookr:::create_code()
```
]]
.column[.content[

```
[1] "cars %&gt;%             # the data  #BREAK\n  filter(speed &gt; 4) %&gt;%  # subset\n  ggplot() +              # pipe to ggplot\n  aes(x = speed) +\n  aes(y = dist) +\n  # Describing what follows\n  geom_point(alpha = .3) + #BREAK\n  geom_point(alpha = 1) + #BREAK2\n  geom_jitter(alpha = .5) + #BREAK3\n  aes(color =\n  speed &gt; 14\n  ) %+%\n  cars -&gt;\n  my_plot  #BREAK"
```
]]
---
class: split-40
count: false
.column[.content[

```r
flipbookr:::create_code() %&gt;%  
* flipbookr:::code_as_table()
```
]]
.column[.content[

```
# A tibble: 14 x 2
   raw_code                                      line
   &lt;chr&gt;                                        &lt;int&gt;
 1 "cars %&gt;%             # the data  #BREAK"        1
 2 "  filter(speed &gt; 4) %&gt;%  # subset"              2
 3 "  ggplot() +              # pipe to ggplot"     3
 4 "  aes(x = speed) +"                             4
 5 "  aes(y = dist) +"                              5
 6 "  # Describing what follows"                    6
 7 "  geom_point(alpha = .3) + #BREAK"              7
 8 "  geom_point(alpha = 1) + #BREAK2"              8
 9 "  geom_jitter(alpha = .5) + #BREAK3"            9
10 "  aes(color ="                                 10
11 "  speed &gt; 14"                                  11
12 "  ) %+%"                                       12
13 "  cars -&gt;"                                     13
14 "  my_plot  #BREAK"                             14
```
]]





---

class: split-40
count: false
.column[.content[

```r
* # The name of the code chunk containing code to be flipped
*flipbookr:::create_code()
```
]]
.column[.content[

```
[1] "cars %&gt;%             # the data  #BREAK\n  filter(speed &gt; 4) %&gt;%  # subset\n  ggplot() +              # pipe to ggplot\n  aes(x = speed) +\n  aes(y = dist) +\n  # Describing what follows\n  geom_point(alpha = .3) + #BREAK\n  geom_point(alpha = 1) + #BREAK2\n  geom_jitter(alpha = .5) + #BREAK3\n  aes(color =\n  speed &gt; 14\n  ) %+%\n  cars -&gt;\n  my_plot  #BREAK"
```
]]
---
class: split-40
count: false
.column[.content[

```r
  # The name of the code chunk containing code to be flipped
flipbookr:::create_code() %&gt;%  
* # parse that code into code, pipes, comments, etc
* flipbookr:::code_base_parse()
```
]]
.column[.content[

```
    line1 col1 line2 col2  id parent                token terminal
137     1    1    14    9 137      0                 expr    FALSE
131     1    1    13    6 131    137                 expr    FALSE
105     1    1     9   25 105    131                 expr    FALSE
90      1    1     8   23  90    105                 expr    FALSE
75      1    1     7   24  75     90                 expr    FALSE
59      1    1     5   15  59     75                 expr    FALSE
45      1    1     4   16  45     59                 expr    FALSE
30      1    1     3   10  30     45                 expr    FALSE
20      1    1     2   19  20     30                 expr    FALSE
1       1    1     1    4   1      3               SYMBOL     TRUE
3       1    1     1    4   3     20                 expr    FALSE
2       1    6     1    8   2     20              SPECIAL     TRUE
4       1   22     1   39   4     20              COMMENT     TRUE
18      2    3     2   19  18     20                 expr    FALSE
6       2    3     2    8   6      8 SYMBOL_FUNCTION_CALL     TRUE
8       2    3     2    8   8     18                 expr    FALSE
7       2    9     2    9   7     18                  '('     TRUE
15      2   10     2   18  15     18                 expr    FALSE
9       2   10     2   14   9     11               SYMBOL     TRUE
11      2   10     2   14  11     15                 expr    FALSE
10      2   16     2   16  10     15                   GT     TRUE
12      2   18     2   18  12     13            NUM_CONST     TRUE
13      2   18     2   18  13     15                 expr    FALSE
14      2   19     2   19  14     18                  ')'     TRUE
19      2   21     2   23  19     30              SPECIAL     TRUE
21      2   26     2   33  21     30              COMMENT     TRUE
28      3    3     3   10  28     30                 expr    FALSE
23      3    3     3    8  23     25 SYMBOL_FUNCTION_CALL     TRUE
25      3    3     3    8  25     28                 expr    FALSE
24      3    9     3    9  24     28                  '('     TRUE
26      3   10     3   10  26     28                  ')'     TRUE
29      3   12     3   12  29     45                  '+'     TRUE
31      3   27     3   42  31     45              COMMENT     TRUE
43      4    3     4   16  43     45                 expr    FALSE
33      4    3     4    5  33     35 SYMBOL_FUNCTION_CALL     TRUE
35      4    3     4    5  35     43                 expr    FALSE
34      4    6     4    6  34     43                  '('     TRUE
36      4    7     4    7  36     43           SYMBOL_SUB     TRUE
37      4    9     4    9  37     43               EQ_SUB     TRUE
38      4   11     4   15  38     40               SYMBOL     TRUE
40      4   11     4   15  40     43                 expr    FALSE
39      4   16     4   16  39     43                  ')'     TRUE
44      4   18     4   18  44     59                  '+'     TRUE
57      5    3     5   15  57     59                 expr    FALSE
47      5    3     5    5  47     49 SYMBOL_FUNCTION_CALL     TRUE
49      5    3     5    5  49     57                 expr    FALSE
48      5    6     5    6  48     57                  '('     TRUE
50      5    7     5    7  50     57           SYMBOL_SUB     TRUE
51      5    9     5    9  51     57               EQ_SUB     TRUE
52      5   11     5   14  52     54               SYMBOL     TRUE
54      5   11     5   14  54     57                 expr    FALSE
53      5   15     5   15  53     57                  ')'     TRUE
58      5   17     5   17  58     75                  '+'     TRUE
61      6    3     6   27  61     75              COMMENT     TRUE
73      7    3     7   24  73     75                 expr    FALSE
63      7    3     7   12  63     65 SYMBOL_FUNCTION_CALL     TRUE
65      7    3     7   12  65     73                 expr    FALSE
64      7   13     7   13  64     73                  '('     TRUE
66      7   14     7   18  66     73           SYMBOL_SUB     TRUE
67      7   20     7   20  67     73               EQ_SUB     TRUE
68      7   22     7   23  68     69            NUM_CONST     TRUE
69      7   22     7   23  69     73                 expr    FALSE
70      7   24     7   24  70     73                  ')'     TRUE
74      7   26     7   26  74     90                  '+'     TRUE
76      7   28     7   33  76     90              COMMENT     TRUE
88      8    3     8   23  88     90                 expr    FALSE
78      8    3     8   12  78     80 SYMBOL_FUNCTION_CALL     TRUE
80      8    3     8   12  80     88                 expr    FALSE
79      8   13     8   13  79     88                  '('     TRUE
81      8   14     8   18  81     88           SYMBOL_SUB     TRUE
82      8   20     8   20  82     88               EQ_SUB     TRUE
83      8   22     8   22  83     84            NUM_CONST     TRUE
84      8   22     8   22  84     88                 expr    FALSE
85      8   23     8   23  85     88                  ')'     TRUE
89      8   25     8   25  89    105                  '+'     TRUE
91      8   27     8   33  91    105              COMMENT     TRUE
103     9    3     9   25 103    105                 expr    FALSE
93      9    3     9   13  93     95 SYMBOL_FUNCTION_CALL     TRUE
95      9    3     9   13  95    103                 expr    FALSE
94      9   14     9   14  94    103                  '('     TRUE
96      9   15     9   19  96    103           SYMBOL_SUB     TRUE
97      9   21     9   21  97    103               EQ_SUB     TRUE
98      9   23     9   24  98     99            NUM_CONST     TRUE
99      9   23     9   24  99    103                 expr    FALSE
100     9   25     9   25 100    103                  ')'     TRUE
104     9   27     9   27 104    131                  '+'     TRUE
106     9   29     9   35 106    131              COMMENT     TRUE
130    10    3    13    6 130    131                 expr    FALSE
124    10    3    12    3 124    130                 expr    FALSE
108    10    3    10    5 108    110 SYMBOL_FUNCTION_CALL     TRUE
110    10    3    10    5 110    124                 expr    FALSE
109    10    6    10    6 109    124                  '('     TRUE
111    10    7    10   11 111    124           SYMBOL_SUB     TRUE
112    10   13    10   13 112    124               EQ_SUB     TRUE
121    11    3    11   12 121    124                 expr    FALSE
114    11    3    11    7 114    116               SYMBOL     TRUE
116    11    3    11    7 116    121                 expr    FALSE
115    11    9    11    9 115    121                   GT     TRUE
117    11   11    11   12 117    118            NUM_CONST     TRUE
118    11   11    11   12 118    121                 expr    FALSE
120    12    3    12    3 120    124                  ')'     TRUE
125    12    5    12    7 125    130              SPECIAL     TRUE
127    13    3    13    6 127    129               SYMBOL     TRUE
129    13    3    13    6 129    130                 expr    FALSE
128    13    8    13    9 128    137         RIGHT_ASSIGN     TRUE
133    14    3    14    9 133    136               SYMBOL     TRUE
136    14    3    14    9 136    137                 expr    FALSE
134    14   12    14   17 134   -137              COMMENT     TRUE
                         text
137                          
131                          
105                          
90                           
75                           
59                           
45                           
30                           
20                           
1                        cars
3                            
2                         %&gt;%
4          # the data  #BREAK
18                           
6                      filter
8                            
7                           (
15                           
9                       speed
11                           
10                          &gt;
12                          4
13                           
14                          )
19                        %&gt;%
21                   # subset
28                           
23                     ggplot
25                           
24                          (
26                          )
29                          +
31           # pipe to ggplot
43                           
33                        aes
35                           
34                          (
36                          x
37                          =
38                      speed
40                           
39                          )
44                          +
57                           
47                        aes
49                           
48                          (
50                          y
51                          =
52                       dist
54                           
53                          )
58                          +
61  # Describing what follows
73                           
63                 geom_point
65                           
64                          (
66                      alpha
67                          =
68                         .3
69                           
70                          )
74                          +
76                     #BREAK
88                           
78                 geom_point
80                           
79                          (
81                      alpha
82                          =
83                          1
84                           
85                          )
89                          +
91                    #BREAK2
103                          
93                geom_jitter
95                           
94                          (
96                      alpha
97                          =
98                         .5
99                           
100                         )
104                         +
106                   #BREAK3
130                          
124                          
108                       aes
110                          
109                         (
111                     color
112                         =
121                          
114                     speed
116                          
115                         &gt;
117                        14
118                          
120                         )
125                       %+%
127                      cars
129                          
128                        -&gt;
133                   my_plot
136                          
134                    #BREAK
```
]]
---
class: split-40
count: false
.column[.content[

```r
  # The name of the code chunk containing code to be flipped
flipbookr:::create_code() %&gt;%  
  # parse that code into code, pipes, comments, etc
  flipbookr:::code_base_parse() %&gt;%  
* flipbookr:::base_parsed_count_parentheses()
```
]]
.column[.content[

```
# A tibble: 14 x 12
    line full_line comment num_open_par num_closed_par num_open_curly
   &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;          &lt;int&gt;          &lt;int&gt;          &lt;int&gt;
 1     1 cars%&gt;%#… "# the…            0              0              0
 2     2 filter(s… "# sub…            1              1              0
 3     3 ggplot()… "# pip…            1              1              0
 4     4 aes(x=sp… ""                 1              1              0
 5     5 aes(y=di… ""                 1              1              0
 6     6 # Descri… "# Des…            0              0              0
 7     7 geom_poi… "#BREA…            1              1              0
 8     8 geom_poi… "#BREA…            1              1              0
 9     9 geom_jit… "#BREA…            1              1              0
10    10 aes(colo… ""                 1              0              0
11    11 speed&gt;14  ""                 0              0              0
12    12 )%+%      ""                 0              1              0
13    13 cars-&gt;    ""                 0              0              0
14    14 my_plot#… "#BREA…            0              0              0
# … with 6 more variables: num_closed_curly &lt;int&gt;, num_open_square &lt;int&gt;,
#   num_closed_square &lt;int&gt;, balanced_paren &lt;lgl&gt;, balanced_curly &lt;lgl&gt;,
#   balanced_square &lt;lgl&gt;
```
]]





---

class: split-40
count: false
.column[.content[

```r
*flipbookr:::create_code()
```
]]
.column[.content[

```
[1] "cars %&gt;%             # the data  #BREAK\n  filter(speed &gt; 4) %&gt;%  # subset\n  ggplot() +              # pipe to ggplot\n  aes(x = speed) +\n  aes(y = dist) +\n  # Describing what follows\n  geom_point(alpha = .3) + #BREAK\n  geom_point(alpha = 1) + #BREAK2\n  geom_jitter(alpha = .5) + #BREAK3\n  aes(color =\n  speed &gt; 14\n  ) %+%\n  cars -&gt;\n  my_plot  #BREAK"
```
]]
---
class: split-40
count: false
.column[.content[

```r
flipbookr:::create_code() %&gt;%  
* flipbookr:::code_parse()
```
]]
.column[.content[

```
# A tibble: 14 x 8
    line raw_code          code        connector comment     auto  user  non_seq
   &lt;int&gt; &lt;chr&gt;             &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;       &lt;lgl&gt; &lt;lgl&gt;   &lt;dbl&gt;
 1     1 "cars %&gt;%       … "cars "     "%&gt;%"     "# the dat… TRUE  TRUE        1
 2     2 "  filter(speed … "  filter(… "%&gt;%"     "# subset"  TRUE  FALSE       1
 3     3 "  ggplot() +   … "  ggplot(… "+"       "# pipe to… TRUE  FALSE       1
 4     4 "  aes(x = speed… "  aes(x =… "+"       ""          TRUE  FALSE       1
 5     5 "  aes(y = dist)… "  aes(y =… "+"       ""          TRUE  FALSE       1
 6     6 "  # Describing … ""          ""        "# Describ… FALSE FALSE       1
 7     7 "  geom_point(al… "  geom_po… "+"       ""          TRUE  TRUE        1
 8     8 "  geom_point(al… "  geom_po… "+"       ""          TRUE  FALSE       2
 9     9 "  geom_jitter(a… "  geom_ji… "+"       ""          TRUE  FALSE       3
10    10 "  aes(color ="   "  aes(col… ""        ""          FALSE FALSE       1
11    11 "  speed &gt; 14"    "  speed &gt;… ""        ""          FALSE FALSE       1
12    12 "  ) %+%"         "  ) "      "%+%"     ""          TRUE  FALSE       1
13    13 "  cars -&gt;"       "  cars "   "-&gt;"      ""          TRUE  FALSE       1
14    14 "  my_plot  #BRE… "  my_plot" ""        ""          TRUE  TRUE        1
```
]]




---
class: middle center inverse

# Step 2
## Reconstruct code into partial builds

---

## First calculate which lines need to be shown and highlighted in each frame of the mini flipbook.

--

A list is returned where each frame corresponds to the element in the list.  

--

Within the list numbers of the lines of code for each frame is returned.

--

This is dependent on what the user has set for the break_type. 
--

Appropriate highlighting is calculated based on what appears in previous frame and what is new in current frame. 


---

class: split-40
count: false
.column[.content[

```r
* # The name of the code chunk containing code to be flipped
*flipbookr:::create_code()
```
]]
.column[.content[

```
[1] "cars %&gt;%             # the data  #BREAK\n  filter(speed &gt; 4) %&gt;%  # subset\n  ggplot() +              # pipe to ggplot\n  aes(x = speed) +\n  aes(y = dist) +\n  # Describing what follows\n  geom_point(alpha = .3) + #BREAK\n  geom_point(alpha = 1) + #BREAK2\n  geom_jitter(alpha = .5) + #BREAK3\n  aes(color =\n  speed &gt; 14\n  ) %+%\n  cars -&gt;\n  my_plot  #BREAK"
```
]]
---
class: split-40
count: false
.column[.content[

```r
  # The name of the code chunk containing code to be flipped
flipbookr:::create_code() %&gt;%  
* # parse that code into code, pipes, comments, etc
* flipbookr:::code_parse()
```
]]
.column[.content[

```
# A tibble: 14 x 8
    line raw_code          code        connector comment     auto  user  non_seq
   &lt;int&gt; &lt;chr&gt;             &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;       &lt;lgl&gt; &lt;lgl&gt;   &lt;dbl&gt;
 1     1 "cars %&gt;%       … "cars "     "%&gt;%"     "# the dat… TRUE  TRUE        1
 2     2 "  filter(speed … "  filter(… "%&gt;%"     "# subset"  TRUE  FALSE       1
 3     3 "  ggplot() +   … "  ggplot(… "+"       "# pipe to… TRUE  FALSE       1
 4     4 "  aes(x = speed… "  aes(x =… "+"       ""          TRUE  FALSE       1
 5     5 "  aes(y = dist)… "  aes(y =… "+"       ""          TRUE  FALSE       1
 6     6 "  # Describing … ""          ""        "# Describ… FALSE FALSE       1
 7     7 "  geom_point(al… "  geom_po… "+"       ""          TRUE  TRUE        1
 8     8 "  geom_point(al… "  geom_po… "+"       ""          TRUE  FALSE       2
 9     9 "  geom_jitter(a… "  geom_ji… "+"       ""          TRUE  FALSE       3
10    10 "  aes(color ="   "  aes(col… ""        ""          FALSE FALSE       1
11    11 "  speed &gt; 14"    "  speed &gt;… ""        ""          FALSE FALSE       1
12    12 "  ) %+%"         "  ) "      "%+%"     ""          TRUE  FALSE       1
13    13 "  cars -&gt;"       "  cars "   "-&gt;"      ""          TRUE  FALSE       1
14    14 "  my_plot  #BRE… "  my_plot" ""        ""          TRUE  TRUE        1
```
]]
---
class: split-40
count: false
.column[.content[

```r
  # The name of the code chunk containing code to be flipped
flipbookr:::create_code() %&gt;%  
  # parse that code into code, pipes, comments, etc
  flipbookr:::code_parse() %&gt;%  
* # calculate which lines to show for each frame
* flipbookr:::parsed_calc_show(break_type = "non_seq")
```
]]
.column[.content[

```
[[1]]
 [1]  1  2  3  4  5  6  7 10 11 12 13 14

[[2]]
 [1]  1  2  3  4  5  6  7  8 10 11 12 13 14

[[3]]
 [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14
```
]]
---
class: split-40
count: false
.column[.content[

```r
  # The name of the code chunk containing code to be flipped
flipbookr:::create_code() %&gt;%  
  # parse that code into code, pipes, comments, etc
  flipbookr:::code_parse() %&gt;%  
  # calculate which lines to show for each frame
  flipbookr:::parsed_calc_show(break_type = "non_seq") %&gt;%  
* # calculate highlighting that is needed for each frame
* flipbookr:::shown_lines_calc_highlight(break_type = "non_seq")
```
]]
.column[.content[

```
[[1]]
integer(0)

[[2]]
[1] 8

[[3]]
[1] 9
```
]]




---

## Based on the calculation, return partial code builds for each frame of the flipbook.

--

We create a list of strings of the partial builds, which can be saved as an object `code_seq`.

---

class: split-40
count: false
.column[.content[

```r
* # from the parsed code
* # and using calc for which lines to display ...
*flipbookr:::create_code()
```
]]
.column[.content[

```
[1] "cars %&gt;%             # the data  #BREAK\n  filter(speed &gt; 4) %&gt;%  # subset\n  ggplot() +              # pipe to ggplot\n  aes(x = speed) +\n  aes(y = dist) +\n  # Describing what follows\n  geom_point(alpha = .3) + #BREAK\n  geom_point(alpha = 1) + #BREAK2\n  geom_jitter(alpha = .5) + #BREAK3\n  aes(color =\n  speed &gt; 14\n  ) %+%\n  cars -&gt;\n  my_plot  #BREAK"
```
]]
---
class: split-40
count: false
.column[.content[

```r
  # from the parsed code
  # and using calc for which lines to display ...
flipbookr:::create_code() %&gt;%  
* flipbookr:::code_parse()
```
]]
.column[.content[

```
# A tibble: 14 x 8
    line raw_code          code        connector comment     auto  user  non_seq
   &lt;int&gt; &lt;chr&gt;             &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;       &lt;lgl&gt; &lt;lgl&gt;   &lt;dbl&gt;
 1     1 "cars %&gt;%       … "cars "     "%&gt;%"     "# the dat… TRUE  TRUE        1
 2     2 "  filter(speed … "  filter(… "%&gt;%"     "# subset"  TRUE  FALSE       1
 3     3 "  ggplot() +   … "  ggplot(… "+"       "# pipe to… TRUE  FALSE       1
 4     4 "  aes(x = speed… "  aes(x =… "+"       ""          TRUE  FALSE       1
 5     5 "  aes(y = dist)… "  aes(y =… "+"       ""          TRUE  FALSE       1
 6     6 "  # Describing … ""          ""        "# Describ… FALSE FALSE       1
 7     7 "  geom_point(al… "  geom_po… "+"       ""          TRUE  TRUE        1
 8     8 "  geom_point(al… "  geom_po… "+"       ""          TRUE  FALSE       2
 9     9 "  geom_jitter(a… "  geom_ji… "+"       ""          TRUE  FALSE       3
10    10 "  aes(color ="   "  aes(col… ""        ""          FALSE FALSE       1
11    11 "  speed &gt; 14"    "  speed &gt;… ""        ""          FALSE FALSE       1
12    12 "  ) %+%"         "  ) "      "%+%"     ""          TRUE  FALSE       1
13    13 "  cars -&gt;"       "  cars "   "-&gt;"      ""          TRUE  FALSE       1
14    14 "  my_plot  #BRE… "  my_plot" ""        ""          TRUE  TRUE        1
```
]]
---
class: split-40
count: false
.column[.content[

```r
  # from the parsed code
  # and using calc for which lines to display ...
flipbookr:::create_code() %&gt;%  
  flipbookr:::code_parse() %&gt;%  
* # ... return the code needed for each slide ...
* flipbookr:::parsed_return_partial_code_sequence()
```
]]
.column[.content[

```
[[1]]
[1] "cars   # the data  #&lt;&lt;"

[[2]]
[1] "cars %&gt;%  # the data  "            "  filter(speed &gt; 4)   # subset#&lt;&lt;"

[[3]]
[1] "cars %&gt;%  # the data  "            "  filter(speed &gt; 4) %&gt;%  # subset"
[3] "  ggplot()   # pipe to ggplot#&lt;&lt;" 

[[4]]
[1] "cars %&gt;%  # the data  "            "  filter(speed &gt; 4) %&gt;%  # subset"
[3] "  ggplot() +  # pipe to ggplot"    "  aes(x = speed)   #&lt;&lt;"           

[[5]]
[1] "cars %&gt;%  # the data  "            "  filter(speed &gt; 4) %&gt;%  # subset"
[3] "  ggplot() +  # pipe to ggplot"    "  aes(x = speed) +  "             
[5] "  aes(y = dist)   #&lt;&lt;"            

[[6]]
[1] "cars %&gt;%  # the data  "            "  filter(speed &gt; 4) %&gt;%  # subset"
[3] "  ggplot() +  # pipe to ggplot"    "  aes(x = speed) +  "             
[5] "  aes(y = dist) +  "               "  # Describing what follows#&lt;&lt;"   
[7] "  geom_point(alpha = .3)   #&lt;&lt;"   

[[7]]
[1] "cars %&gt;%  # the data  "            "  filter(speed &gt; 4) %&gt;%  # subset"
[3] "  ggplot() +  # pipe to ggplot"    "  aes(x = speed) +  "             
[5] "  aes(y = dist) +  "               "  # Describing what follows"      
[7] "  geom_point(alpha = .3) +  "      "  geom_point(alpha = 1)   #&lt;&lt;"    

[[8]]
[1] "cars %&gt;%  # the data  "            "  filter(speed &gt; 4) %&gt;%  # subset"
[3] "  ggplot() +  # pipe to ggplot"    "  aes(x = speed) +  "             
[5] "  aes(y = dist) +  "               "  # Describing what follows"      
[7] "  geom_point(alpha = .3) +  "      "  geom_point(alpha = 1) +  "      
[9] "  geom_jitter(alpha = .5)   #&lt;&lt;"  

[[9]]
 [1] "cars %&gt;%  # the data  "            "  filter(speed &gt; 4) %&gt;%  # subset"
 [3] "  ggplot() +  # pipe to ggplot"    "  aes(x = speed) +  "             
 [5] "  aes(y = dist) +  "               "  # Describing what follows"      
 [7] "  geom_point(alpha = .3) +  "      "  geom_point(alpha = 1) +  "      
 [9] "  geom_jitter(alpha = .5) +  "     "  aes(color =  #&lt;&lt;"               
[11] "  speed &gt; 14  #&lt;&lt;"                 "  )   #&lt;&lt;"                        

[[10]]
 [1] "cars %&gt;%  # the data  "            "  filter(speed &gt; 4) %&gt;%  # subset"
 [3] "  ggplot() +  # pipe to ggplot"    "  aes(x = speed) +  "             
 [5] "  aes(y = dist) +  "               "  # Describing what follows"      
 [7] "  geom_point(alpha = .3) +  "      "  geom_point(alpha = 1) +  "      
 [9] "  geom_jitter(alpha = .5) +  "     "  aes(color =  "                  
[11] "  speed &gt; 14  "                    "  ) %+%  "                        
[13] "  cars   #&lt;&lt;"                     

[[11]]
 [1] "cars %&gt;%  # the data  "            "  filter(speed &gt; 4) %&gt;%  # subset"
 [3] "  ggplot() +  # pipe to ggplot"    "  aes(x = speed) +  "             
 [5] "  aes(y = dist) +  "               "  # Describing what follows"      
 [7] "  geom_point(alpha = .3) +  "      "  geom_point(alpha = 1) +  "      
 [9] "  geom_jitter(alpha = .5) +  "     "  aes(color =  "                  
[11] "  speed &gt; 14  "                    "  ) %+%  "                        
[13] "  cars -&gt;  "                       "  my_plot  #&lt;&lt;"                   
```
]]
---
class: split-40
count: false
.column[.content[

```r
  # from the parsed code
  # and using calc for which lines to display ...
flipbookr:::create_code() %&gt;%  
  flipbookr:::code_parse() %&gt;%  
  # ... return the code needed for each slide ...
  flipbookr:::parsed_return_partial_code_sequence() -&gt;  
* # ... save this list
*code_seq
```
]]
.column[.content[

]]








---
class: middle center inverse

# Step 3 
## Deliver to a presentation platform (here Xaringan)

---

## We have generic code chunk templates ...


```r
return_partial_chunks_template_code()
```

```
[1] "```{r {{{chunk_name}}}_{{{break_type}}}_{{{breaks}}}_code, eval = FALSE, echo = TRUE, code = code_seq[[{{{breaks}}}]]}\n  ```"
```

```r
return_partial_chunks_template_output()
```

```
[1] "```{r {{{chunk_name}}}_{{{break_type}}}_{{{breaks}}}_output, eval = TRUE, echo = FALSE, code = code_seq[[{{{breaks}}}]]}\n```"
```





---

## ... which are used to create chunks of code and output displayed side-by-side


```r
chunk_expand(chunk_name = "cars_plot")
```

````
class: split-40
count: false
.column[.content[
```{r cars_plot_auto_1_code, eval = FALSE, echo = TRUE, code = code_seq[[1]]}
  ```
]]
.column[.content[
```{r cars_plot_auto_1_output, eval = TRUE, echo = FALSE, code = code_seq[[1]]}
```
]]
---
class: split-40
count: false
.column[.content[
```{r cars_plot_auto_2_code, eval = FALSE, echo = TRUE, code = code_seq[[2]]}
  ```
]]
.column[.content[
```{r cars_plot_auto_2_output, eval = TRUE, echo = FALSE, code = code_seq[[2]]}
```
]]
````


---

## ... or a series of slides that *just* display output or *just* display code 



```r
chunk_expand(num_breaks = 2, display_type = "code")
```

````
count: false
```{r example_auto_1_code, eval = FALSE, echo = TRUE, code = code_seq[[1]]}
  ```
---
count: false
```{r example_auto_2_code, eval = FALSE, echo = TRUE, code = code_seq[[2]]}
  ```
````

```r
chunk_expand(num_breaks = 2, display_type = "output")
```

````
count: false
```{r example_auto_1_output, eval = TRUE, echo = FALSE, code = code_seq[[1]]}
```
---
count: false
```{r example_auto_2_output, eval = TRUE, echo = FALSE, code = code_seq[[2]]}
```
````




---

# The reveal asks for the chunks we've created to be evaluated, by using the knitr::knit() function. 

We've applied it above.  Let's just look at the function itself.  


```r
chunk_reveal
```

```
function (chunk_name = "example_name", break_type = "auto", left_assign = F, 
    code_seq = chunk_name_return_code_sequence(chunk_name, break_type, 
        left_assign), num_breaks = length(code_seq), display_type = "both", 
    split = 40) 
{
    text &lt;- chunk_expand(chunk_name = chunk_name, break_type = break_type, 
        num_breaks = num_breaks, display_type = display_type, 
        split = split)
    paste(knitr::knit(text = text), collapse = "\n")
}
&lt;bytecode: 0x7f93470c98f8&gt;
&lt;environment: namespace:flipbookr&gt;
```

---

# Notes (points of vacillation)

I'm vacillating on the public function name still.  I thought about chunk_reveal, reveal, flipbookify, flipify.
Most recently, I was most excited about chunk_reveal, but the function will also work with the parsed and expanded code as an input, which I think is really cool, and makes the code nice and flexible a la Yihui here:  https://yihui.org/en/2018/11/two-roads/

Related, I'm a little nervous about code_seq argument.  What if code_seq is defined in the global environment? 
There is this interesting warning about this formulation: https://adv-r.hadley.nz/functions.html#default-arguments  

Probably the right (worry free) way is to set the default to NULL, and then do an if.null() inside the function where code_seq is defined. The one downside is that this is a little verbose, right?  num_breaks would also need to be adjusted in this way. 

Another point of waffling was the argument order.  What's really the main input, is it the expanded code, or is it the chunk name?  Which ever (I'm not sure) should be the first thing. It probably must be the chunk name, as this is the way people will most likely use the code, else there would be a lot of confusion for the user.  Still, I found it unsatisfying that you, can't then somehow pipe code into this final function. 


---


# Go to code [**here**](https://github.com/EvaMaeRey/flipbookr/blob/master/R/base_parse_reveal_xaringan.R)

https://github.com/EvaMaeRey/flipbookr/blob/master/R/base_parse_reveal_xaringan.R





&lt;style type="text/css"&gt;
.remark-code{line-height: 1.5; font-size: 60%}
&lt;/style&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:10",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
